Bootstrap:docker
From:python:3.8


%labels
	MAINTAINER Markus Johansson <markus.h.johansson@skane.se>
	DESCRIPTION Singularity container for CMD microbiology WGS pipeline
	VERSION 4.1.11

%post
     RESFINDER_VERSION=4.1.11
     KMA_VERSION=1.3.27
     BLAST_VERSION=2.9.0

	 agt-get update &&    \
	 agt-get upgrade -y && \
	 apt-get install -y --no-cache-dir git && \
	 rm -rf /var/lib/apt/lists/*/var/lib/apt/lists/*

	 cd $HOME &&  \
	 git clone -b "${RESFINDER_VERSION}" --depth 1 https://bitbucket.org/genomicepidemiology/resfinder.git && \
	 ln -s "${HOME}/resfinder/run_resfinder.py" /usr/bin && \
	 pip3 install tabulate biopython cgecore gitpython python-dateutil

	 git clone -b "${KMA_VERSION}" https://bitbucket.org/genomicepidemiology/kma.git resfinder/cge/kma && \
	 cd resfinder/cge/kma &&                                                                              \
	 make &&                                                                                              \
	 ln -s $(pwd)/kma $(pwd)/kma_index $(pwd)/kma_shm $(pwd)/kma_update /usr/bin

	 cd $HOME &&                                                                                                                                    \
	 wget -O blast.tar.gz "https://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/${BLAST_VERSION}/ncbi-blast-${BLAST_VERSION}+-x64-linux.tar.gz" && \
	 tar -xzf blast.tar.gz && \
	 cd "ncbi-blast-${BLAST_VERSION}+/bin/" && \
	 chmod +x * && \
	 cp * /usr/bin && \
	 cd $HOME
